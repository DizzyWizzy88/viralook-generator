FILE: src/app/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

html, body, #__next {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  background-color: #070707;
}

/* Prevents the 'gray highlight' on mobile taps */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Custom scrollbar for that Pro Studio look */
::-webkit-scrollbar {
  width: 5px;
}
::-webkit-scrollbar-track {
  background: #070707;
}
::-webkit-scrollbar-thumb {
  background: #222;
  border-radius: 10px;
}
@layer components {
  /* 1. Summoning Text Shimmer */
  .summoning-shimmer {
    background: linear-gradient(90deg, #555, #fff, #555);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: textShimmer 3s linear infinite;
  }

  /* 2. Viral Legend Border Beam */
  .border-beam-card {
    position: relative;
    overflow: hidden;
  }

  .border-beam-card::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(transparent, #7400ff, #00f2ff, transparent 30%);
    animation: rotate-beam 4s linear infinite;
  }

  /* Keeps the card content dark inside the beam */
  .card-inner-content {
    position: relative;
    background: #0a0a0a;
    z-index: 10;
    margin: 2px; /* This defines the thickness of the beam */
    border-radius: inherit;
  }
}

@keyframes textShimmer {
  to { background-position: 200% center; }
}

@keyframes rotate-beam {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@layer components {
  .border-beam-card {
    position: absolute;
    inset: 0;
    border: 2px solid transparent;
    background: linear-gradient(black, black) padding-box,
                linear-gradient(90deg, #4f46e5, #9333ea, #06b6d4, #4f46e5) border-box;
    background-size: 200% 100%;
    animation: border-beam 4s linear infinite;
  }

  .summoning-shimmer {
    background: linear-gradient(90deg, #52525b, #ffffff, #52525b);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shimmer 3s linear infinite;
  }

  @keyframes border-beam {
    to { background-position: 200% center; }
  }

  @keyframes shimmer {
    to { background-position: 200% center; }
  }
}

---
FILE: src/app/layout.tsx
import type { Metadata, Viewport } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { ServiceWorkerRegistrar } from "@/components/ServiceWorkerRegistrar";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

/**
 * 2026 PWA Metadata
 * This replaces the old <link> tags in the head.
 * The 'manifest' property automatically links to your app/manifest.ts
 */
export const metadata: Metadata = {
  title: "Viralook AI Studio | AI Summoning Suite",
  description: "The ultimate AI summoning suite for viral creators. Manifest your vision in seconds.",
  manifest: "/manifest.webmanifest", // Generated by manifest.ts
  appleWebApp: {
    capable: true,
    statusBarStyle: "black-translucent",
    title: "Viralook AI",
  },
};

/**
 * Modern Next.js 15+ Viewport Config
 * Ensures the app looks like a native "Viralook" app (no zooming, neon theme).
 */
export const viewport: Viewport = {
  themeColor: "#000000",
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" className="dark">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased bg-black text-white selection:bg-cyan-500/30`}
      >
        {/* The bridge between the browser and your background service worker */}
        <ServiceWorkerRegistrar />
        
        {/* Main Application Container */}
        <div className="relative min-h-screen overflow-x-hidden">
          {/* Subtle Global Neon Backdrop */}
          <div className="fixed inset-0 bg-[radial-gradient(circle_at_50%_50%,#161616_0%,#000000_100%)] -z-10" />
          
          {children}
        </div>
      </body>
    </html>
  );
}


---
FILE: src/app/page.tsx
"use client";
import { useEffect } from 'react';
import { useRouter } from 'next/navigation';

export default function HomePage() {
  const router = useRouter();
  useEffect(() => {
    // Only redirect if we are in the browser
    if (typeof window !== "undefined") {
      router.push('/login');
    }
  }, [router]);

  return <div className="bg-black min-h-screen text-white flex items-center justify-center">Loading VIRALOOK...</div>;
}

---
FILE: src/app/dashboard/page.tsx
"use client";
export const dynamic = "force-dynamic";

import { useState, useEffect } from "react";

export default function Dashboard() {
  const [credits, setCredits] = useState("...");

  useEffect(() => {
    // Firebase logic only runs after the page loads in the app
    const initFirebase = async () => {
      const { db } = await import("@/lib/firebase");
      const { doc, onSnapshot } = await import("firebase/firestore");
      
      onSnapshot(doc(db, "users", "user_dev_01"), (doc) => {
        if (doc.exists()) setCredits(doc.data().credits);
      });
    };
    initFirebase();
  }, []);

  return (
    <div className="min-h-screen bg-black text-white p-8">
      <h1 className="text-2xl font-black">DASHBOARD</h1>
      <p className="mt-4">Credits: {credits}</p>
    </div>
  );
}

---
FILE: src/app/login/success/page.tsx
"use client";
export const dynamic = "force-dynamic";
import { useEffect } from 'react';
import { useRouter } from 'next/navigation';

export default function LoginSuccess() {
  const router = useRouter();
  useEffect(() => {
    router.push('/dashboard');
  }, [router]);
  return <div className="bg-black min-h-screen text-white p-8">Redirecting...</div>;
}

---
FILE: src/app/login/page.tsx
"use client";

import { useState } from "react";
import { auth } from "@/lib/firebase"; 
import { 
  signInWithEmailAndPassword, 
  GoogleAuthProvider, 
  signInWithPopup 
} from "firebase/auth";
import { useRouter } from "next/navigation";
import Link from "next/link";

export default function LoginPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  // 1. Handle Email/Password Login (Required for Google Reviewer)
  const handleEmailLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError("");
    try {
      await signInWithEmailAndPassword(auth, email, password);
      router.push("/dashboard");
    } catch (err: any) {
      setError("Invalid email or password. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  // 2. Handle Google Login (For regular users)
  const handleGoogleLogin = async () => {
    setLoading(true);
    setError("");
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
      router.push("/dashboard");
    } catch (err: any) {
      setError("Google sign-in failed. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-black text-white p-4">
      <div className="w-full max-w-md space-y-6 bg-zinc-900 p-8 rounded-2xl border border-zinc-800 shadow-2xl">
        
        <div className="text-center">
          <Link href="/" className="text-xs text-zinc-500 hover:text-white transition-colors mb-4 inline-block">
            ‚Üê Back to Home
          </Link>
          <h1 className="text-3xl font-bold tracking-tight">Viralook</h1>
          <p className="text-zinc-400 mt-2 text-sm">Sign in to your account</p>
        </div>

        {error && (
          <div className="bg-red-500/10 border border-red-500/50 text-red-500 p-3 rounded-lg text-xs text-center">
            {error}
          </div>
        )}

        {/* Traditional Form */}
        <form onSubmit={handleEmailLogin} className="space-y-4">
          <div className="space-y-1">
            <label className="text-xs font-semibold text-zinc-400 uppercase ml-1">Email</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full p-3 rounded-lg bg-zinc-800 border border-zinc-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              placeholder="name@example.com"
              required
            />
          </div>
          <div className="space-y-1">
            <label className="text-xs font-semibold text-zinc-400 uppercase ml-1">Password</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full p-3 rounded-lg bg-zinc-800 border border-zinc-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>
          <button
            type="submit"
            disabled={loading}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-all disabled:opacity-50"
          >
            {loading ? "Authenticating..." : "Sign In"}
          </button>
        </form>

        {/* New Navigation Links */}
        <div className="flex justify-between px-1 text-sm">
          <Link href="/forgot-password" title="Reset your password" className="text-zinc-400 hover:text-white transition-colors">
            Forgot Password?
          </Link>
          <Link href="/signup" title="Create a new account" className="text-blue-500 hover:text-blue-400 font-medium transition-colors">
            Create Account
          </Link>
        </div>

        <div className="relative py-2">
          <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-zinc-800"></div></div>
          <div className="relative flex justify-center text-xs uppercase"><span className="bg-zinc-900 px-2 text-zinc-500">Or continue with</span></div>
        </div>

        {/* Google Button */}
        <button
          onClick={handleGoogleLogin}
          disabled={loading}
          className="w-full flex items-center justify-center gap-3 bg-white text-black font-semibold py-3 rounded-lg hover:bg-zinc-100 transition-all disabled:opacity-50"
        >
          <img 
            src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" 
            alt="Google logo" 
            className="w-5 h-5" 
          />
          Sign In with Google
        </button>
      </div>
    </div>
  );
}

---
FILE: src/app/profile/page.tsx
"use client";
export const dynamic = "force-dynamic";

import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';

export default function ProfilePage() {
  const [userEmail, setUserEmail] = useState("...");
  const router = useRouter();

  useEffect(() => {
    const initFirebase = async () => {
      // Dynamically import to keep it away from the build worker
      const { auth } = await import("@/lib/firebase");
      const { onAuthStateChanged } = await import("firebase/auth");
      
      onAuthStateChanged(auth, (user) => {
        if (user) {
          setUserEmail(user.email || "No email");
        } else {
          router.push('/login');
        }
      });
    };
    initFirebase();
  }, [router]);

  return (
    <div className="min-h-screen bg-black text-white p-8">
      <h1 className="text-2xl font-black">USER PROFILE</h1>
      <p className="mt-4 text-zinc-400">Account: {userEmail}</p>
      <button 
        onClick={() => router.push('/dashboard')}
        className="mt-8 px-6 py-2 bg-white text-black font-bold rounded-full"
      >
        BACK TO STUDIO
      </button>
    </div>
  );
}

---
FILE: src/app/success/page.tsx
"use client";
export const dynamic = "force-dynamic";
export default function SuccessPage() {
  return <div className="min-h-screen bg-black text-white p-8"><h1>Success!</h1></div>;
}

---
FILE: src/app/privacy/page.tsx
export default function PrivacyPolicy() {
  const containerStyle = {
    padding: '40px',
    maxWidth: '800px',
    margin: '0 auto',
    backgroundColor: '#000000',
    color: '#ffffff',
    minHeight: '100vh',
    fontFamily: 'sans-serif',
    lineHeight: '1.6'
  };

  const headerStyle = { color: '#ffffff', borderBottom: '1px solid #333', paddingBottom: '10px' };
  const textStyle = { color: '#ffffff' };

  return (
    <div style={containerStyle}>
      <h1 style={headerStyle}>Privacy Policy</h1>
      <p style={textStyle}>Last updated: January 20, 2026</p>

      <h2 style={headerStyle}>1. Information We Collect</h2>
      <p style={textStyle}>We collect minimal information to provide our service, including device identifiers and data provided via Stripe for subscriptions.</p>

      <h2 style={headerStyle}>2. How We Use Data</h2>
      <p style={textStyle}>Data is used solely to provide image generation services through our AI partners (fal.ai) and to manage your paid subscriptions.</p>

      <h2 style={headerStyle}>3. Contact Us</h2>
      <p style={textStyle}>For questions regarding this policy, please contact us at your support email.</p>
    </div>
  );
}

---
FILE: src/app/terms/page.tsx
"use client";
export const dynamic = "force-dynamic";
export default function TermsPage() {
  return <div className="min-h-screen bg-black text-white p-8"><h1>Terms of Service</h1></div>;
}

---
FILE: src/app/forgot-password/page.tsx
"use client";

import { useState } from "react";
import { auth } from "@/lib/firebase";
import { sendPasswordResetEmail } from "firebase/auth";
import Link from "next/link";

export default function ForgotPasswordPage() {
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");
  const [error, setError] = useState("");

  const handleReset = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await sendPasswordResetEmail(auth, email);
      setMessage("Check your inbox for a reset link!");
      setError("");
    } catch (err: any) {
      setError("Could not send reset email. Check the address.");
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-black text-white p-4">
      <div className="w-full max-w-md bg-zinc-900 p-8 rounded-2xl border border-zinc-800">
        <h1 className="text-2xl font-bold mb-4">Reset Password</h1>
        {message && <p className="text-green-500 mb-4 text-sm">{message}</p>}
        {error && <p className="text-red-500 mb-4 text-sm">{error}</p>}
        <form onSubmit={handleReset} className="space-y-4">
          <input
            type="email"
            placeholder="Enter your email"
            className="w-full p-3 rounded-lg bg-zinc-800 border border-zinc-700"
            onChange={(e) => setEmail(e.target.value)}
            required
          />
          <button type="submit" className="w-full bg-blue-600 py-3 rounded-lg font-bold">
            Send Reset Link
          </button>
        </form>
        <Link href="/login" className="block text-center mt-4 text-sm text-zinc-400 hover:text-white">
          Back to Login
        </Link>
      </div>
    </div>
  );
}

---
FILE: src/app/signup/page.tsx
"use client";

import { useState } from "react";
import { auth } from "@/lib/firebase";
import { createUserWithEmailAndPassword } from "firebase/auth";
import { useRouter } from "next/navigation";
import Link from "next/link";

export default function SignUpPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [agreed, setAgreed] = useState(false);
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleSignUp = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!agreed) {
      setError("Please agree to the Terms and Privacy Policy to continue.");
      return;
    }

    setLoading(true);
    setError("");

    try {
      await createUserWithEmailAndPassword(auth, email, password);
      router.push("/dashboard");
    } catch (err: any) {
      if (err.code === 'auth/email-already-in-use') {
        setError("This email is already registered.");
      } else if (err.code === 'auth/weak-password') {
        setError("Password should be at least 6 characters.");
      } else {
        setError("An error occurred. Please try again.");
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-black text-white p-4 font-sans">
      <div className="w-full max-w-md bg-zinc-900 p-8 rounded-2xl border border-zinc-800 shadow-2xl">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold">Join Viralook</h1>
          <p className="text-zinc-400 mt-2">Create your account to start generating</p>
        </div>

        {error && (
          <div className="bg-red-500/10 border border-red-500/50 text-red-500 p-3 rounded-lg text-xs text-center mb-6">
            {error}
          </div>
        )}

        <form onSubmit={handleSignUp} className="space-y-5">
          <div>
            <label className="text-xs font-semibold text-zinc-500 uppercase ml-1">Email Address</label>
            <input
              type="email"
              placeholder="you@example.com"
              className="w-full p-3 mt-1 rounded-lg bg-zinc-800 border border-zinc-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>

          <div>
            <label className="text-xs font-semibold text-zinc-500 uppercase ml-1">Password</label>
            <input
              type="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              className="w-full p-3 mt-1 rounded-lg bg-zinc-800 border border-zinc-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>

          {/* Legal Consent Checkbox */}
          <div className="flex items-start gap-3 py-2">
            <input 
              type="checkbox" 
              id="terms" 
              checked={agreed}
              onChange={(e) => setAgreed(e.target.checked)}
              className="w-4 h-4 mt-1 rounded border-zinc-700 bg-zinc-800 text-blue-600 focus:ring-blue-500"
            />
            <label htmlFor="terms" className="text-xs text-zinc-400 leading-tight">
              I agree to the <Link href="/legal" className="text-blue-500 hover:underline">Terms of Service</Link> and <Link href="/legal" className="text-blue-500 hover:underline">Privacy Policy</Link>.
            </label>
          </div>

          <button 
            type="submit" 
            disabled={loading}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all disabled:opacity-50"
          >
            {loading ? "Creating Account..." : "Create Account"}
          </button>
        </form>

        <div className="mt-8 pt-6 border-t border-zinc-800 text-center">
          <p className="text-zinc-400 text-sm">
            Already have an account? <Link href="/login" className="text-blue-500 font-semibold hover:text-blue-400">Log In</Link>
          </p>
        </div>
      </div>
    </div>
  );
}

---
FILE: src/app/legal/page.tsx
"use client";

import Link from "next/link";

export default function LegalPage() {
  return (
    <div style={{ backgroundColor: '#000000', color: '#d4d4d8', minHeight: '100vh', padding: '2rem', fontFamily: 'sans-serif' }}>
      <div style={{ maxWidth: '48rem', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ borderBottom: '1px solid #27272a', paddingBottom: '2rem', marginBottom: '3rem' }}>
          <Link href="/signup" style={{ color: '#3b82f6', textDecoration: 'none', fontSize: '0.875rem' }}>
            ‚Üê Back to Signup
          </Link>
          <h1 style={{ color: '#ffffff', fontSize: '2.25rem', fontWeight: 'bold', marginTop: '1rem' }}>
            Legal & Privacy Center
          </h1>
          <p style={{ color: '#71717a', marginTop: '0.5rem' }}>Last Updated: January 2026</p>
        </div>

        {/* 1. Account Deletion */}
        <section style={{ backgroundColor: '#18181b', padding: '1.5rem', borderRadius: '0.75rem', border: '1px solid #27272a', marginBottom: '3rem' }}>
          <h2 style={{ color: '#ffffff', fontSize: '1.5rem', fontWeight: '600', marginBottom: '1rem' }}>
            Account & Data Deletion
          </h2>
          <p style={{ lineHeight: '1.6' }}>
            Users may request full removal of their account and associated data via the email link below.
          </p>
          <div style={{ marginTop: '1.5rem' }}>
            <a 
              href="mailto:dr3930397@gmail.com?subject=Account%20Deletion%20Request"
              style={{ display: 'inline-block', backgroundColor: '#ffffff', color: '#000000', fontWeight: 'bold', padding: '0.6rem 1.5rem', borderRadius: '0.375rem', textDecoration: 'none' }}
            >
              Request Account Deletion
            </a>
          </div>
        </section>

        {/* 2. Privacy Policy */}
        <section style={{ marginBottom: '3rem' }}>
          <h2 style={{ color: '#ffffff', fontSize: '1.5rem', fontWeight: '600', marginBottom: '1rem' }}>Privacy Policy</h2>
          <ul style={{ paddingLeft: '1.5rem', lineHeight: '1.8' }}>
            <li><strong style={{ color: '#ffffff' }}>Email:</strong> Collected for account authentication.</li>
            <li><strong style={{ color: '#ffffff' }}>Photos:</strong> Processed solely for AI generation.</li>
          </ul>
        </section>

        <footer style={{ borderTop: '1px solid #27272a', paddingTop: '2rem', textAlign: 'center', color: '#52525b', fontSize: '0.875rem' }}>
          &copy; 2026 Viralook Generator ‚Ä¢ dr3930397@gmail.com
        </footer>
      </div>
    </div>
  );
}

---
FILE: src/app/manifest.ts
export const dynamic = "force-static";
import { MetadataRoute } from 'next'

export default function manifest(): MetadataRoute.Manifest {
  return {
    name: 'Viralook AI Studio',
    short_name: 'Viralook',
    description: 'The ultimate AI summoning suite for viral creators.',
    start_url: '/',
    display: 'standalone',
    background_color: '#000000',
    theme_color: '#06b6d4', // Neon Cyan
    icons: [
      {
        src: '/icon-192.png',
        sizes: '192x192',
        type: 'image/png',
      },
      {
        src: '/icon-512.png',
        sizes: '512x512',
        type: 'image/png',
      },
    ],
  }
}

---
FILE: src/lib/firebase/serverAdmin.ts
import * as admin from "firebase-admin";

/**
 * Singleton pattern for Firebase Admin to prevent multiple 
 * initializations during Hot Module Replacement (HMR) in Next.js.
 */
const initializeAdmin = () => {
  if (admin.apps.length > 0) {
    return admin.app();
  }

  // Formatting the private key for Vercel/Production
  // In your .env, the key often contains escaped newlines (\n) 
  // that need to be converted to actual newline characters.
  const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, "\n");

  return admin.initializeApp({
    credential: admin.credential.cert({
      projectId: process.env.FIREBASE_PROJECT_ID,
      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
      privateKey: privateKey,
    }),
    // Required for credit validation and "Viral Legend" database triggers
    databaseURL: `https://${process.env.FIREBASE_PROJECT_ID}.firebaseio.com`,
  });
};

// Initialize the app
const adminApp = initializeAdmin();

// Export the specific services needed for credit management
export const adminDb = adminApp.firestore();
export const adminAuth = adminApp.auth();

// Export FieldValue for atomic credit decrements (e.g., FieldValue.increment(-1))
export const FieldValue = admin.firestore.FieldValue;

export default adminApp;

---
FILE: src/lib/firebase/clientApp.ts
import { initializeApp, getApps, getApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

// Initialize Firebase only once
const app = getApps().length > 0 ? getApp() : initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

export { app, auth, db };

---
FILE: src/lib/server/authUtils.ts
// src/lib/server/authUtils.ts (SERVER-SIDE ONLY)
import { NextRequest } from 'next/server'; 
import { adminAuth } from '@/lib/firebase/serverAdmin'; 

/**
 * Verifies the Firebase ID token from the request headers.
 * This is the security gate for all privileged API routes.
 * * @param req The incoming Next.js API route request (NextRequest for App Router).
 * @returns The authenticated user's UID (string) or null if verification fails.
 */
export async function verifyIdToken(req: NextRequest): Promise<string | null> {
    const authHeader = req.headers.get('authorization');
    
    // 1. Check for valid Authorization header (must be 'Bearer <token>')
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
        // console.warn('Missing or improperly formatted Authorization header.');
        return null;
    }

    // Extract the ID Token
    const idToken = authHeader.split('Bearer ')[1];

    try {
        // 2. Use the Firebase Admin SDK to verify the token's signature, expiry, and issuer
        const decodedToken = await adminAuth.verifyIdToken(idToken);
        
        // 3. Return the user's unique ID (UID)
        return decodedToken.uid;
    } catch (error) {
        // This catches token errors like expired, invalid signature, etc.
        console.error('Error verifying Firebase ID Token:', error);
        return null;
    }
}

---
FILE: src/lib/server/stripe.ts
// src/lib/server/stripe.ts (SERVER-SIDE ONLY)
import Stripe from 'stripe';

// Initialize Stripe with the Secret Key from Vercel environment variables
const STRIPE_SECRET_KEY = process.env.STRIPE_SECRET_KEY;

if (!STRIPE_SECRET_KEY) {
    throw new Error('STRIPE_SECRET_KEY environment variable is not set.');
}

export const stripe = new Stripe(STRIPE_SECRET_KEY, {
    apiVersion: '2024-06-20', // Use a recent stable API version
});

// Define the plans you offer for easy reference
export const plans = {
    PRO_MONTHLY: {
        priceId: 'price_XXXXXX', // REPLACE with your Stripe Price ID for Monthly Pro
        name: 'Pro Monthly',
        credits: 100,
    },
    // Add other plans here (e.g., Annual, One-time pack)
};

---
FILE: src/lib/firebaseAdmin.ts
import * as admin from "firebase-admin";

if (!admin.apps.length) {
  admin.initializeApp({
    credential: admin.credential.cert({
      projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, "\n"),
    }),
  });
}

const adminDb = admin.firestore();

export { adminDb };

---
FILE: src/lib/firebase.ts
import { initializeApp, getApps, getApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID
};

// SAFETY CHECK: If we are building (server-side), don't initialize Firebase
const isBrowser = typeof window !== "undefined";

let app;
if (isBrowser) {
    app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
} else {
    // Return a dummy object during build to prevent the "Invalid API Key" crash
    app = { name: "dummy" } as any;
}

export const auth = isBrowser ? getAuth(app) : {} as any;
export const db = isBrowser ? getFirestore(app) : {} as any;
export { app };

---
FILE: src/lib/registry.tsx
"use client";

import React, { useState } from "react";
import { useServerInsertedHTML } from "next/navigation";
import { AppRegistry } from "react-native-web";

export default function ReactNativeRegistry({ children }: { children: React.ReactNode }) {
  const [styles] = useState(() => {
    AppRegistry.registerComponent("Main", () => () => null);
    // @ts-ignore
    const { getStyleElement } = AppRegistry.getApplication("Main");
    return getStyleElement();
  });

  useServerInsertedHTML(() => {
    return <>{styles}</>;
  });

  return <>{children}</>;
}

---
FILE: src/lib/api.ts
/**
 * src/lib/api.ts
 * Helper to ensure the Android app calls the absolute Vercel URL
 */

const PRODUCTION_URL = 'https://viralook-generator.vercel.app';
const LOCAL_URL = 'http://localhost:3000';

export const getApiUrl = (path: string): string => {
  // Use the Vercel URL if we are building for production (Android App)
  const baseUrl = process.env.NODE_ENV === 'production' 
    ? PRODUCTION_URL 
    : LOCAL_URL;

  // Ensure the path starts with a slash
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  
  return `${baseUrl}${cleanPath}`;
};

---
FILE: src/components/GeneratorInput.tsx
"use client";

import React, { useState } from 'react';

export default function GeneratorInput({ onGenerate }: { onGenerate: (prompt: string) => void }) {
  const [prompt, setPrompt] = useState("");

  return (
    <div className="space-y-6">
      <div className="relative group">
        <textarea
          value={prompt}
          onChange={(e) => setPrompt(e.target.value)}
          placeholder="Describe your vision..."
          className="w-full h-48 bg-zinc-900/30 border border-zinc-800 rounded-[2rem] p-8 text-white placeholder:text-zinc-700 focus:outline-none focus:border-zinc-600 transition-all resize-none"
        />
      </div>
      
      <button
        onClick={() => onGenerate(prompt)}
        className="w-full py-6 bg-white text-black rounded-3xl font-black text-sm uppercase tracking-widest hover:bg-zinc-200 transition-all active:scale-[0.98] shadow-[0_20px_50px_rgba(255,255,255,0.1)]"
      >
        Create Visual
      </button>
    </div>
  );
}

---
FILE: src/components/LoadingBar.tsx
"use client";

import React from 'react';

/**
 * LoadingBar Component
 * Displays the "Summoning" state with a shimmering text effect 
 * and a modern, high-tech progress line.
 */
export default function LoadingBar({ progress }: { progress: number }) {
  return (
    <div className="w-full max-w-md mx-auto flex flex-col items-center justify-center py-12 space-y-8">
      
      {/* 1. The Summoning Text */}
      {/* The 'summoning-shimmer' class must be defined in your globals.css */}
      <div className="summoning-shimmer text-center text-sm md:text-base tracking-[0.3em] uppercase font-black italic">
        Summoning the AI Gods...
      </div>

      {/* 2. The Progress Track */}
      <div className="relative w-full h-[1px] bg-zinc-800 rounded-full overflow-hidden">
        
        {/* The Actual Progress Fill */}
        <div 
          className="absolute top-0 left-0 h-full bg-gradient-to-r from-purple-600 via-cyan-400 to-purple-600 shadow-[0_0_20px_rgba(168,85,247,0.6)] transition-all duration-700 ease-in-out"
          style={{ width: `${progress}%` }}
        />
        
        {/* Kinetic Scan Effect (The moving light pulse) */}
        <div className="absolute top-0 left-0 h-full w-24 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-scan" />
      </div>

      {/* 3. Status Percentage */}
      <div className="flex flex-col items-center gap-1">
        <span className="text-[9px] font-black text-zinc-500 tracking-[0.4em] uppercase opacity-70">
          Manifesting {Math.round(progress)}%
        </span>
      </div>
    </div>
  );
}

---
FILE: src/components/ThemeToggle.tsx
"use client";

import React from 'react';

export default function ThemeToggle({ isDark, toggle }: { isDark: boolean, toggle: () => void }) {
  return (
    <button
      onClick={toggle}
      className="p-3 rounded-2xl transition-all duration-300 bg-white/10 border border-white/20 hover:bg-white/20"
      title="Toggle Appearance"
    >
      {isDark ? '‚òÄÔ∏è' : 'üåô'}
    </button>
  );
}

---
FILE: src/components/HeroShowcase.tsx
"use client";

import React from 'react';

// Placeholder images - in a real app, these would come from your best generations!
const images = [
  'https://framerusercontent.com/images/kM0O9eMvR2uH9yX6x8m07d1z0.jpg',
  'https://framerusercontent.com/images/bLdD3g0mB7fX6n5e4r3q2o1p.jpg',
  'https://framerusercontent.com/images/aXyZ2w1vU3tS4r5q6p7o8n9m.jpg',
  'https://framerusercontent.com/images/cEdF1gH2iJ3kL4m5nO6pQ7rS.jpg',
  'https://framerusercontent.com/images/dYxW1zV2uT3sR4q5p6o7n8m9.jpg',
  'https://framerusercontent.com/images/eFgH1iJ2kL3mN4o5P6qR7sT8.jpg',
  'https://framerusercontent.com/images/fGhI1jK2lM3nO4p5Q6rS7tU8.jpg',
  'https://framerusercontent.com/images/gHiJ1kL2mN3oP4q5R6sT7uV8.jpg',
  'https://framerusercontent.com/images/hIjK1lM2nO3pQ4r5S6tU7vW8.jpg',
];

export default function HeroShowcase() {
  return (
    <section className="py-20 bg-gradient-to-br from-[#020617] to-indigo-950 overflow-hidden relative">
      <div className="text-center mb-16 px-4">
        <h2 className="text-white text-4xl md:text-6xl font-black tracking-tighter leading-tight italic">
          Turn your <span className="text-blue-500">ideas</span> into <br />
          <span className="text-blue-400">viral</span> looks.
        </h2>
        <p className="mt-6 text-xl text-zinc-300 max-w-2xl mx-auto">
          Unleash the power of AI to create stunning visuals for your brand,
          social media, or personal projects in seconds.
        </p>
      </div>

      {/* Infinite Scroll Container */}
      <div className="relative w-full overflow-hidden py-4">
        <div className="flex animate-marquee whitespace-nowrap">
          {images.concat(images).map((img, index) => ( // Duplicate to create seamless loop
            <img 
              key={index}
              src={img} 
              alt={`Viralook showcase ${index}`} 
              className="w-80 h-auto aspect-[3/4] object-cover rounded-3xl mx-4 shadow-xl border border-zinc-700"
            />
          ))}
        </div>
      </div>
      <div className="relative w-full overflow-hidden py-4 mt-8">
        <div className="flex animate-marquee-reverse whitespace-nowrap">
          {images.concat(images).reverse().map((img, index) => ( // Duplicate & Reverse
            <img 
              key={index}
              src={img} 
              alt={`Viralook showcase reverse ${index}`} 
              className="w-80 h-auto aspect-[3/4] object-cover rounded-3xl mx-4 shadow-xl border border-zinc-700"
            />
          ))}
        </div>
      </div>
    </section>
  );
}

---
FILE: src/components/ImageGallery.tsx
"use client";

import { Download, Trash2, ExternalLink } from 'lucide-react';

export default function ImageGallery({ images, setImages }: any) {
  
  const handleRemove = (id: string) => {
    setImages(images.filter((item: any) => item.id !== id));
  };

  if (!images || images.length === 0) {
    return (
      <div className="text-center py-20 border-2 border-dashed border-white/5 rounded-[3rem]">
        <p className="text-zinc-600 uppercase text-[10px] tracking-[0.3em] font-bold">Vault Empty</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {images.map((item: any) => (
        <div key={item.id} className="group relative bg-zinc-900 rounded-[2.5rem] overflow-hidden border border-white/5">
          <img 
            src={item.url} 
            alt="Viralook Artwork" 
            className="w-full aspect-square object-cover" 
          />
          <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex flex-col justify-between p-6">
            <div className="flex justify-end">
              <button onClick={() => handleRemove(item.id)} className="p-3 bg-red-500/20 text-red-500 rounded-2xl hover:bg-red-500 hover:text-white transition">
                <Trash2 size={18} />
              </button>
            </div>
            <div className="flex gap-2">
              <button onClick={() => window.open(item.url, '_blank')} className="flex-1 bg-white/10 p-4 rounded-2xl flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-widest">
                <ExternalLink size={14} /> View
              </button>
              <a href={item.url} target="_blank" rel="noopener noreferrer" className="flex-1 bg-blue-600 p-4 rounded-2xl flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-widest text-center">
                <Download size={14} /> Save
              </a>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
}

---
FILE: src/components/DashboardContent.tsx
"use client";

import React, { useState, useEffect, Suspense } from 'react';
import { 
  getAuth, 
  signOut, 
  onAuthStateChanged, 
  User as FirebaseUser 
} from 'firebase/auth';
import { 
  getFirestore, doc, onSnapshot, collection, query, limit, orderBy, 
  getDoc, setDoc, where 
} from 'firebase/firestore';
import { app } from '@/lib/firebase/clientApp';
import { useRouter, useSearchParams } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import confetti from 'canvas-confetti';
import ImageGallery from './ImageGallery';
import PricingTable from './PricingTable';
import { 
  LogOut, LayoutGrid, Globe, User, 
  Camera, Ghost, Circle, Sparkles 
} from 'lucide-react';

export default function DashboardContent() {
  return (
    <Suspense fallback={<div className="min-h-screen bg-black flex items-center justify-center text-zinc-500 font-black tracking-widest uppercase text-xs animate-pulse">Initializing Studio...</div>}>
      <DashboardInner />
    </Suspense>
  );
}

function DashboardInner() {
  const auth = getAuth(app);
  const db = getFirestore(app);
  const router = useRouter();
  const searchParams = useSearchParams();

  const [user, setUser] = useState<FirebaseUser | null>(null);
  const [credits, setCredits] = useState<number | null>(null);
  const [isUnlimited, setIsUnlimited] = useState(false);
  const [loading, setLoading] = useState(false);
  const [images, setImages] = useState([]);
  const [communityImages, setCommunityImages] = useState<any[]>([]);
  const [prompt, setPrompt] = useState("");
  const [activeCategory, setActiveCategory] = useState("CINEMATIC");

  const categories = [
    { id: "CINEMATIC", icon: <Camera size={14}/> },
    { id: "PORTRAIT", icon: <User size={14}/> },
    { id: "ANIME", icon: <Ghost size={14}/> },
    { id: "FANTASY", icon: <Sparkles size={14}/> },
    { id: "MINIMALIST", icon: <Circle size={14}/> },
  ];

  // 1. Auth & User Data
  useEffect(() => {
    const unsubscribeAuth = onAuthStateChanged(auth, async (currentUser) => {
      if (!currentUser) { 
        router.push('/login'); 
        return; 
      }
      setUser(currentUser);
      
      const userRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(userRef);
      
      if (!docSnap.exists()) {
        await setDoc(userRef, {
          credits: 5,
          email: currentUser.email,
          createdAt: new Date().toISOString(),
          isUnlimited: false
        });
      }

      return onSnapshot(userRef, (docSnap) => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          setCredits(data.credits ?? 0);
          setIsUnlimited(data.isUnlimited ?? false);
        }
      });
    });
    return () => unsubscribeAuth();
  }, [auth, db, router]);

  // 2. Filtered Global Feed Logic
  useEffect(() => {
    // Queries images that match the selected category
    const q = query(
      collection(db, "global_feed"), 
      where("category", "==", activeCategory),
      orderBy("createdAt", "desc"), 
      limit(15)
    );

    const unsubscribeFeed = onSnapshot(q, (snapshot) => {
      setCommunityImages(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
    }, (error) => {
      console.warn("Feed error (likely missing index):", error);
      // Fallback to unfiltered feed if index isn't ready yet
      const fallbackQ = query(collection(db, "global_feed"), orderBy("createdAt", "desc"), limit(15));
      onSnapshot(fallbackQ, (s) => setCommunityImages(s.docs.map(d => ({ id: d.id, ...d.data() }))));
    });

    return () => unsubscribeFeed();
  }, [db, activeCategory]);

  const handleSignOut = () => signOut(auth).then(() => router.push('/'));
  
  const generateImage = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!prompt || loading) return;
    setLoading(true);
    try {
      const res = await fetch("/api/generate", { 
        method: "POST", 
        body: JSON.stringify({ prompt, userId: user?.uid, category: activeCategory }) 
      });
      const data = await res.json();
      if (data.url) {
        setImages([{ id: Date.now().toString(), url: data.url, prompt }, ...images] as any);
        setPrompt("");
        confetti({ particleCount: 40, velocity: 30, spread: 360, colors: ['#3b82f6', '#ffffff'] });
      }
    } finally { setLoading(false); }
  };

  if (!user) return null;

  return (
    <div className="min-h-screen bg-black text-white font-sans">
      <nav className="fixed top-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-xl border-b border-white/5">
        <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-[0_0_20px_rgba(37,99,235,0.4)]">
              <Sparkles size={20} className="text-white" />
            </div>
            <div className="flex flex-col leading-none">
              <span className="text-lg font-black italic tracking-tighter uppercase">Viralook</span>
              <span className="text-[8px] font-bold text-blue-500 tracking-[0.3em] uppercase">AI Studio</span>
            </div>
          </div>

          <div className="flex items-center gap-6">
            <div className="hidden md:flex bg-zinc-900/50 px-4 py-2 rounded-full border border-white/10 items-center gap-2">
              <div className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse" />
              <span className="text-[10px] font-black text-zinc-400 uppercase tracking-widest">
                {isUnlimited ? "Unlimited" : `${credits} Credits`}
              </span>
            </div>
            <button onClick={() => router.push('/profile')} className="w-10 h-10 rounded-full border border-white/20 overflow-hidden hover:scale-105 transition-transform">
              <img src={user?.photoURL || `https://api.dicebear.com/7.x/identicon/svg?seed=${user?.uid}`} alt="User" />
            </button>
            <button onClick={handleSignOut} className="text-zinc-500 hover:text-white transition-colors">
              <LogOut size={18} />
            </button>
          </div>
        </div>
      </nav>

      <main className="pt-40 max-w-6xl mx-auto px-6 space-y-32 pb-20">
        <header className="text-center space-y-8">
          <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-7xl md:text-8xl font-black italic tracking-tighter uppercase leading-[0.85]">
            Visualize <span className="text-zinc-800">Everything.</span>
          </motion.h1>
          <div className="flex flex-wrap justify-center gap-3">
            {categories.map((cat) => (
              <button key={cat.id} onClick={() => setActiveCategory(cat.id)}
                className={`flex items-center gap-2 px-6 py-3 rounded-full text-[9px] font-black uppercase tracking-widest border transition-all ${
                  activeCategory === cat.id ? "bg-blue-600 border-blue-500 shadow-lg" : "bg-zinc-900 border-white/5 text-zinc-500 hover:border-white/20"
                }`}
              >
                {cat.icon} {cat.id}
              </button>
            ))}
          </div>
        </header>

        <section className="max-w-4xl mx-auto">
          <form onSubmit={generateImage} className="bg-zinc-900/40 border border-white/10 rounded-[2.5rem] p-3 flex items-center gap-4 focus-within:border-blue-500/50 transition-all">
            <input type="text" value={prompt} onChange={(e)=>setPrompt(e.target.value)} placeholder={`Describe your ${activeCategory.toLowerCase()} vision...`} className="flex-1 bg-transparent border-none px-6 py-4 text-white placeholder:text-zinc-700 focus:ring-0 text-lg" />
            <button type="submit" disabled={loading} className="bg-white text-black hover:bg-zinc-200 px-10 py-5 rounded-[1.8rem] font-black uppercase text-[11px] tracking-widest transition-all disabled:opacity-50">
              {loading ? "Processing..." : "Generate"}
            </button>
          </form>
        </section>

        <section className="space-y-12">
          <div className="flex items-center justify-between border-b border-white/5 pb-4">
            <div className="flex items-center gap-3">
              <Globe size={14} className="text-blue-500" />
              <h2 className="text-[10px] font-black uppercase tracking-[0.4em]">Inspiration: {activeCategory}</h2>
            </div>
          </div>
          <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
            {communityImages.map((img) => (
              <div key={img.id} className="aspect-square rounded-2xl overflow-hidden border border-white/5 bg-zinc-900">
                <img src={img.url} className="w-full h-full object-cover opacity-60 hover:opacity-100 transition-opacity" alt="Community" />
              </div>
            ))}
          </div>
        </section>

        <section className="space-y-12">
          <div className="flex items-center gap-3 border-b border-white/5 pb-4">
            <LayoutGrid size={14} className="text-blue-500" />
            <h2 className="text-[10px] font-black uppercase tracking-[0.4em]">Your Private Vault</h2>
          </div>
          <ImageGallery images={images} setImages={setImages} />
        </section>

        <PricingTable userId={user?.uid} />
      </main>
    </div>
  );
}

---
FILE: src/components/LoginContent.tsx
"use client";

import React, { useState } from 'react';
import { 
  getAuth, 
  signInWithEmailAndPassword, 
  signInWithPopup, 
  GoogleAuthProvider 
} from 'firebase/auth';
import { 
  getFirestore, 
  doc, 
  getDoc, 
  setDoc, 
  serverTimestamp 
} from 'firebase/firestore';
import { app } from '@/lib/firebase/clientApp';
import { useRouter } from 'next/navigation';

export default function LoginContent() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const auth = getAuth(app);
  const db = getFirestore(app);
  const router = useRouter();

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await signInWithEmailAndPassword(auth, email, password);
      router.push('/dashboard');
    } catch (error) {
      alert("Login failed. Check your credentials.");
    }
  };

  const loginWithGoogle = async () => {
    const provider = new GoogleAuthProvider();
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      // AUTO-SIGNUP LOGIC: Check if user document exists in Firestore
      const userRef = doc(db, "users", user.uid);
      const userSnap = await getDoc(userRef);

      if (!userSnap.exists()) {
        // Create the user document with 5 starter credits
        await setDoc(userRef, {
          uid: user.uid,
          email: user.email,
          displayName: user.displayName,
          photoURL: user.photoURL,
          credits: 5,
          createdAt: serverTimestamp(),
        });
        console.log("New user document created with 5 credits!");
      }

      router.push('/dashboard');
    } catch (error) {
      console.error("Google Login Error:", error);
      alert("Google login failed. Please check if popups are blocked.");
    }
  };

  return (
    <div className="min-h-screen bg-[#050505] flex items-center justify-center px-6">
      <div className="max-w-md w-full space-y-8 bg-zinc-900/50 p-10 rounded-[3rem] border border-white/5 backdrop-blur-xl">
        <div className="text-center space-y-2">
          <img src="/Viralook.png" alt="Viralook" className="h-8 mx-auto mb-4" />
          <h2 className="text-3xl font-black tracking-tighter text-white italic uppercase">Welcome Back</h2>
          <p className="text-zinc-500 text-[10px] font-black uppercase tracking-[0.3em]">Enter the Studio</p>
        </div>

        <form onSubmit={handleLogin} className="space-y-4">
          <input 
            type="email" 
            placeholder="EMAIL ADDRESS" 
            className="w-full bg-black border border-white/10 rounded-2xl px-6 py-5 text-xs text-white focus:outline-none focus:border-blue-500 transition-all font-bold placeholder:text-zinc-700"
            onChange={(e) => setEmail(e.target.value)}
          />
          <input 
            type="password" 
            placeholder="PASSWORD" 
            className="w-full bg-black border border-white/10 rounded-2xl px-6 py-5 text-xs text-white focus:outline-none focus:border-blue-500 transition-all font-bold placeholder:text-zinc-700"
            onChange={(e) => setPassword(e.target.value)}
          />
          <button type="submit" className="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-2xl transition-all shadow-xl shadow-blue-500/20 tracking-[0.2em] text-[10px]">
            SIGN IN
          </button>
        </form>

        <div className="relative py-4">
          <div className="absolute inset-0 flex items-center"><span className="w-full border-t border-white/5"></span></div>
          <div className="relative flex justify-center text-[10px] uppercase font-black tracking-[0.3em]"><span className="bg-zinc-900 px-4 text-zinc-600">OR</span></div>
        </div>

        <button 
          type="button"
          onClick={loginWithGoogle} 
          className="w-full bg-white text-black font-black py-5 rounded-2xl hover:bg-zinc-200 transition-all flex items-center justify-center gap-3 text-[10px] tracking-[0.2em] shadow-2xl active:scale-95"
        >
          CONTINUE WITH GOOGLE
        </button>
      </div>
    </div>
  );
}

---
FILE: src/components/AuthGuard.tsx
"use client";

import { useEffect, useState } from 'react';
import { getAuth, onAuthStateChanged } from 'firebase/auth';
import { app } from '@/lib/firebase/clientApp';
import { useRouter } from 'next/navigation';

export default function AuthGuard({ children }: { children: React.ReactNode }) {
  const [loading, setLoading] = useState(true);
  const [authorized, setAuthorized] = useState(false);
  const auth = getAuth(app);
  const router = useRouter();

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (user) => {
      if (!user) {
        // User is not logged in, send them to login
        router.push('/login');
      } else {
        // User is logged in, allow them to see the page
        setAuthorized(true);
      }
      setLoading(false);
    });

    return () => unsubscribe();
  }, [auth, router]);

  if (loading) {
    return (
      <div className="min-h-screen bg-black flex items-center justify-center">
        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-blue-500"></div>
      </div>
    );
  }

  return authorized ? <>{children}</> : null;
}

---
FILE: src/components/PricingTable.tsx
"use client";

import React from 'react';
import { CheckCircle2 } from 'lucide-react';

export default function PricingTable({ userId }: { userId?: string }) {
  const handleCheckout = async (planType: string) => {
    if (!userId) return alert("Please log in first.");
    // ... your checkout logic
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto px-4">
      {/* Starter Card */}
      <div className="bg-[#0f0f0f] border border-zinc-800 p-8 rounded-[2rem] flex flex-col items-start text-left">
        <span className="text-[10px] font-black text-zinc-500 uppercase tracking-widest mb-1">Starter</span>
        <div className="text-3xl font-black mb-6 text-white">$0</div>
        <button className="w-full py-3 bg-zinc-800 text-zinc-500 rounded-xl font-bold text-xs uppercase tracking-widest cursor-default">
          Current
        </button>
      </div>

      {/* Pro Card (Highlighted) */}
      <div className="bg-[#0f0f0f] border-2 border-cyan-500 p-8 rounded-[2rem] flex flex-col items-start text-left relative shadow-[0_0_30px_rgba(6,182,212,0.2)]">
        <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-cyan-500 text-[8px] font-black px-3 py-1 rounded-full uppercase text-black">Popular</div>
        <span className="text-[10px] font-black text-cyan-400 uppercase tracking-widest mb-1">Pro</span>
        <div className="text-3xl font-black mb-6 text-white">$19.99</div>
        <button className="w-full py-3 bg-cyan-500 text-black rounded-xl font-black text-xs uppercase tracking-widest hover:bg-cyan-400 transition-all">
          Upgrade
        </button>
      </div>

      {/* Legend Card */}
      <div className="bg-[#0f0f0f] border border-zinc-800 p-8 rounded-[2rem] flex flex-col items-start text-left">
        <span className="text-[10px] font-black text-zinc-500 uppercase tracking-widest mb-1">Legend</span>
        <div className="text-3xl font-black mb-6 text-white">$39.99</div>
        <button className="w-full py-3 bg-zinc-800 text-white rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-zinc-700 transition-all">
          Go Legend
        </button>
      </div>
    </div>
  );
}

---
FILE: src/components/Generator.tsx
"use client";

import React, { useState, useEffect } from 'react';
import LoadingBar from './LoadingBar'; 
import GeneratorInput from './GeneratorInput';
import { useSummoningSequence } from '@/hooks/useSummoningSequence';
import ImageGallery from './ImageGallery';

const STYLES = [
  { id: 'cyberpunk', label: 'Cyberpunk', prompt: 'cyberpunk style, neon lights, futuristic, high contrast' },
  { id: 'vintage', label: '90s Vintage', prompt: '90s vintage film aesthetic, grainy, nostalgic colors, lo-fi' },
  { id: 'anime', label: 'Anime', prompt: 'high-quality anime style, vibrant, studio ghibli inspired' },
  { id: 'vogue', label: 'Vogue', prompt: 'high fashion editorial, professional lighting, minimalist background' }
];

const LOADING_MESSAGES = [
  "Gathering viral pixels...",
  "Calibrating aesthetic levels...",
  "Summoning the look...",
  "Finalizing your viral masterpiece..."
];

export default function Generator() {
  const [isGenerating, setIsGenerating] = useState(false);
  const [generatedImages, setGeneratedImages] = useState<string[]>([]);
  const [selectedStyle, setSelectedStyle] = useState<string | null>(null);
  const [currentMessageIndex, setCurrentMessageIndex] = useState(0);
  const [error, setError] = useState<string | null>(null);

  const { progress, startSummoning, resetSummoning } = useSummoningSequence();

  // Cycle through loading messages while generating
  useEffect(() => {
    let interval: NodeJS.Timeout;
    if (isGenerating) {
      interval = setInterval(() => {
        setCurrentMessageIndex((prev) => (prev + 1) % LOADING_MESSAGES.length);
      }, 3000);
    }
    return () => clearInterval(interval);
  }, [isGenerating]);

  const handleGenerate = async (basePrompt: string) => {
    if (!basePrompt) return;
    setIsGenerating(true);
    setError(null);
    startSummoning();

    // Enhance prompt with selected style
    const styleSuffix = selectedStyle 
      ? STYLES.find(s => s.id === selectedStyle)?.prompt 
      : "viral aesthetic, high resolution, 8k";
    
    const finalPrompt = `${basePrompt}, ${styleSuffix}`;

    try {
      const response = await fetch('/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: finalPrompt }),
      });

      if (!response.ok) throw new Error("Generation failed");

      const data = await response.json();
      if (data.imageUrl) {
        setGeneratedImages((prev) => [data.imageUrl, ...prev]);
      }
    } catch (err) {
      console.error(err);
      setError("Something went wrong. Please try again.");
    } finally {
      setIsGenerating(false);
      resetSummoning();
      setCurrentMessageIndex(0);
    }
  };

  return (
    <div className="w-full space-y-12">
      {/* Style Selector */}
      {!isGenerating && (
        <div className="flex flex-wrap gap-2 justify-center mb-6">
          {STYLES.map((style) => (
            <button
              key={style.id}
              onClick={() => setSelectedStyle(style.id === selectedStyle ? null : style.id)}
              className={`px-4 py-2 rounded-full border text-sm transition-all ${
                selectedStyle === style.id 
                ? 'bg-white text-black border-white' 
                : 'bg-transparent text-zinc-400 border-zinc-700 hover:border-zinc-500'
              }`}
            >
              {style.label}
            </button>
          ))}
        </div>
      )}

      {isGenerating ? (
        <div className="flex flex-col items-center justify-center min-h-[400px] space-y-6">
          <LoadingBar progress={progress} />
          <p className="text-zinc-400 animate-pulse text-sm">
            {LOADING_MESSAGES[currentMessageIndex]}
          </p>
        </div>
      ) : (
        <div className="space-y-4">
          <GeneratorInput onGenerate={handleGenerate} />
          {error && <p className="text-red-500 text-center text-sm">{error}</p>}
        </div>
      )}

      {generatedImages.length > 0 && (
        <div className="pt-12 border-t border-zinc-900">
          <h3 className="text-zinc-500 text-xs uppercase tracking-widest mb-8 text-center">Your Style History</h3>
          <ImageGallery images={generatedImages} />
        </div>
      )}
    </div>
  );
}

---
FILE: src/components/CreditBadge.tsx
"use client";

import { useEffect, useState } from "react";

export default function CreditBadge() {
  const [data, setData] = useState<{ credits: number | string; tier: string } | null>(null);

  useEffect(() => {
    // Fetch user data from your existing generate route (which returns credit count)
    const checkCredits = async () => {
      try {
        const res = await fetch("/api/generate", { method: "POST", body: JSON.stringify({ ping: true }) });
        const json = await res.json();
        setData({
          credits: json.remaining === null ? "‚àû" : json.remaining,
          tier: json.tier || "free"
        });
      } catch (err) {
        console.error("Failed to load credits");
      }
    };
    checkCredits();
  }, []);

  if (!data) return null;

  const isLegend = data.tier === "viral_legend";
  const isPro = data.tier === "pro";

  return (
    <div className={`inline-flex items-center px-4 py-2 rounded-full border shadow-sm transition-all ${
      isLegend ? "bg-orange-50 border-orange-200 text-orange-700" : 
      isPro ? "bg-purple-50 border-purple-200 text-purple-700" : 
      "bg-gray-50 border-gray-200 text-gray-600"
    }`}>
      <span className="text-xs font-bold uppercase tracking-wider mr-2">
        {isLegend ? "üëë Legend" : isPro ? "‚≠ê Pro" : "Free"}
      </span>
      <div className="h-4 w-[1px] bg-current opacity-20 mr-2"></div>
      <span className="font-mono font-bold">
        {data.credits} {typeof data.credits === "number" ? "Credits" : ""}
      </span>
    </div>
  );
}

---
FILE: src/components/UniversalButton.tsx
"use client";

import React from 'react';
import { Pressable, Text, StyleSheet, ViewStyle } from 'react-native';

interface Props {
  title: string;
  onPress: () => void;
  style?: ViewStyle;
}

export const UniversalButton = ({ title, onPress, style }: Props) => {
  return (
    <Pressable
      onPress={onPress}
      style={({ pressed, hovered }: any) => [
        styles.button,
        style,
        hovered && styles.buttonHover,
        pressed && styles.buttonPressed
      ]}
    >
      <Text style={styles.text}>{title}</Text>
    </Pressable>
  );
};

const styles = StyleSheet.create({
  button: {
    backgroundColor: '#ffffff',
    paddingVertical: 14,
    paddingHorizontal: 24,
    borderRadius: 12,
    alignItems: 'center',
    justifyContent: 'center',
  },
  buttonHover: {
    backgroundColor: '#f0f0f0',
    transform: [{ scale: 1.02 }],
  },
  buttonPressed: {
    backgroundColor: '#e0e0e0',
    transform: [{ scale: 0.98 }],
  },
  text: {
    color: '#000000',
    fontSize: 14,
    fontWeight: '700',
    letterSpacing: 1,
    textTransform: 'uppercase',
  }
});

---
FILE: src/components/UniversalInput.tsx
"use client";

import React from 'react';
import { TextInput, StyleSheet, View, Text } from 'react-native';

interface Props {
  label: string;
  value: string;
  onChangeText: (text: string) => void;
  placeholder: string;
  multiline?: boolean;
}

export const UniversalInput = ({ label, value, onChangeText, placeholder, multiline = false }: Props) => {
  return (
    <View style={styles.container}>
      <Text style={styles.label}>{label}</Text>
      <TextInput
        value={value}
        onChangeText={onChangeText}
        placeholder={placeholder}
        placeholderTextColor="#555"
        multiline={multiline}
        style={[styles.input, multiline && styles.textArea]}
        // This ensures the keyboard doesn't cover the input on mobile
        cursorColor="#fff"
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    marginBottom: 20,
    width: '100%',
  },
  label: {
    color: '#888',
    fontSize: 10,
    fontWeight: '900',
    textTransform: 'uppercase',
    letterSpacing: 2,
    marginBottom: 8,
    paddingLeft: 4,
  },
  input: {
    backgroundColor: '#000',
    borderWidth: 1,
    borderColor: '#222',
    borderRadius: 16,
    padding: 16,
    color: '#fff',
    fontSize: 14,
  },
  textArea: {
    height: 120,
    textAlignVertical: 'top', // Important for Android
  },
});

---
FILE: src/components/ServiceWorkerRegistrar.tsx
"use client";
import { useEffect } from 'react';

export function ServiceWorkerRegistrar() {
  useEffect(() => {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('/sw.js')
        .then((reg) => console.log('‚úÖ Viralook System Online:', reg.scope))
        .catch((err) => console.error('‚ùå System Link Failed:', err));
    }
  }, []);

  return null;
}

---
FILE: src/types/canvas-confetti.d.ts
declare module 'canvas-confetti';

---
FILE: src/hooks/useSummoningSequence.ts
import { useState, useEffect } from 'react';

const SUMMONING_MESSAGES = [
  "Summoning the AI Gods...",
  "Awakening the AI Core...",
  "Consulting the Digital Oracles...",
  "Synthesizing Viral Sigils...",
  "Channelling Neon Energy...",
  "Manifesting your Vision..."
];

export const useSummoningSequence = (isLoading: boolean) => {
  const [currentMessage, setCurrentMessage] = useState(SUMMONING_MESSAGES[0]);
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    if (!isLoading) {
      setProgress(0);
      setCurrentMessage(SUMMONING_MESSAGES[0]);
      return;
    }

    // Cycle messages every 2.5 seconds
    const msgInterval = setInterval(() => {
      setCurrentMessage(prev => {
        const index = SUMMONING_MESSAGES.indexOf(prev);
        return SUMMONING_MESSAGES[(index + 1) % SUMMONING_MESSAGES.length];
      });
    }, 2500);

    // Exponential progress (fast at first, slows down near 95%)
    const progInterval = setInterval(() => {
      setProgress(prev => (prev < 95 ? prev + (95 - prev) * 0.1 : prev));
    }, 400);

    return () => {
      clearInterval(msgInterval);
      clearInterval(progInterval);
    };
  }, [isLoading]);

  return { currentMessage, progress };
};

---
{
  "name": "viralook-generator",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build --webpack",
    "start": "next start",
    "lint": "next lint",
    "mobile:sync": "npm run build && npx cap sync",
    "mobile": "npx expo start"
  },
  "dependencies": {
    "@capacitor/android": "^8.0.1",
    "@capacitor/cli": "^7.4.5",
    "@capacitor/core": "^8.0.1",
    "@expo/next-adapter": "^6.0.0",
    "@fal-ai/client": "^1.7.2",
    "@fal-ai/server-proxy": "^1.1.2",
    "@fal-ai/serverless-client": "latest",
    "@tailwindcss/postcss": "^4.1.18",
    "autoprefixer": "^10.4.23",
    "canvas-confetti": "^1.9.4",
    "expo": "~54.0.30",
    "expo-next-react-navigation": "latest",
    "firebase": "^11.1.0",
    "firebase-admin": "^13.0.1",
    "lucide-react": "latest",
    "next": "^16.1.1",
    "react": "19.2.1",
    "react-dom": "19.2.1",
    "react-native": "0.76.0",
    "react-native-web": "^0.19.13",
    "solito": "latest",
    "stripe": "^20.1.0"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "typescript": "^5"
  },
  "overrides": {
    "react": "19.2.1",
    "react-dom": "19.2.1",
    "react-native-web": {
      "react": "19.2.1"
    }
  }
}
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: 'export',
  images: {
    unoptimized: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  // ESLint is now handled via the 'eslint' key with 'ignoreDuringBuilds'
  eslint: {
    ignoreDuringBuilds: true,
  },
};

export default nextConfig;
import type { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.viralook.generator',
  appName: 'Viralook Generator',
  webDir: 'out', // Change 'www' to 'out'
  bundledWebRuntime: false
};

export default config;
